<!DOCTYPE html>
<html>

<head>
	<title>Planar Parameterization</title>
	<script src="p5.js"></script>
	<style>
		canvas {
			display: block;
			margin: 0 auto;
		}
	</style>
</head>

<body>
	<script>
		let rows = 500;
		let cols = 50;
		let scl = 100;
		let w = 1200;
		let h = 600;

		let plane = [];

		let initialPlane = [];
		let finalShape = [];

		let lerpVal = 0;
		let lerpDir = 1;

		let count = 0;
		let countMax = 50;

		let camX = 0;
		let camY = -200;
		let camZ = 500;

		function setup() {
			createCanvas(w, h, WEBGL);

			for (let i = 0; i < rows; i++) {
				finalShape[i] = [];
				initialPlane[i] = [];
				for (let j = 0; j < cols; j++) {
					let u = map(i/rows,0,1-1/rows,0,2*Math.PI*10)-Math.PI/2;
					let v = map(j/cols,0,1-1/cols,0,2*Math.PI)+Math.PI;
					finalShape[i][j] = [scl*x(u, v), scl*y(u, v), scl*z(u, v)];
					initialPlane[i][j] = [-10*i+rows/2*10,scl*0,10*j-cols/2*10];
				}
			}
		}

		function x(u, v) {
			return (cos(v)+2)*cos(u);
		}

		function y(u, v) {
			return (cos(v)+2)*sin(u);
		}

		function z(u, v) {
			return sin(v)-u/2;
		}


		function draw() {
			for (let i = 0; i < rows; i++) {
				plane[i] = [];
				for (let j = 0; j < cols; j++) {
					plane[i][j] = p5.Vector.lerp(createVector(initialPlane[i][j][0], initialPlane[i][j][1], initialPlane[i][j][2]), createVector(finalShape[i][j][0], finalShape[i][j][1], finalShape[i][j][2]), lerpVal)
				}
			}
			
			console.log(lerpVal);

			if (lerpVal > 1 || lerpVal < 0) {
				count += 1;
				if (count > countMax) {
					lerpDir *= -1;
					count = 0;
					lerpVal += .01*lerpDir;
				}
			} else {
				lerpVal += .01*lerpDir;
			}
			
			background(255);

			//stroke(0,100,0);
			noStroke();
			//noFill();

			// move and rotate camera
			orbitControl();

			// draw terrain
			for (let i = 0; i < rows-1; i++) {
				
				for (let j = 0; j < cols-1; j++) {
					beginShape();
					//fill(0,0,i/rows*100+155);
					fill(map(noise(i/rows*3), 0, 1, 0, 255), map(noise(j/cols*3), 0, 1, 0, 255), 0)

					vertex(plane[i][j].x, plane[i][j].y, plane[i][j].z);
					vertex(plane[i+1][j].x, plane[i+1][j].y, plane[i+1][j].z);
					vertex(plane[i+1][j+1].x, plane[i+1][j+1].y, plane[i+1][j+1].z);

					endShape();

					beginShape();

					fill(map(noise(i/rows*3), 0, 1, 0, 100), map(noise(j/cols*3), 0, 1, 0, 100),0)

					vertex(plane[i][j].x, plane[i][j].y, plane[i][j].z);
					vertex(plane[i][j+1].x, plane[i][j+1].y, plane[i][j+1].z);
					vertex(plane[i+1][j+1].x, plane[i+1][j+1].y, plane[i+1][j+1].z);

					endShape();
				}
			}

			//fillLRSeams();
			//fillTBSeams();
			//fillLastSeam();
		}

		function fillLRSeams() {
			for (let i = 0; i < rows-1; i++) {
				beginShape();
				fill(0,0,i/rows*100+155);
				
				vertex(plane[i][cols-1].x, plane[i][cols-1].y, plane[i][cols-1].z);
				vertex(plane[i+1][cols-1].x, plane[i+1][cols-1].y, plane[i+1][cols-1].z);
				vertex(plane[i+1][0].x, plane[i+1][0].y, plane[i+1][0].z);

				vertex(plane[i][cols-1].x, plane[i][cols-1].y, plane[i][cols-1].z);
				vertex(plane[i][0].x, plane[i][0].y, plane[i][0].z);
				vertex(plane[i+1][0].x, plane[i+1][0].y, plane[i+1][0].z);
				
				endShape();
			}
		}

		function fillTBSeams() {
			for (let j = 0; j < cols-1; j++) {
				beginShape();
				fill(0,0,155);
				vertex(plane[rows-1][j].x, plane[rows-1][j].y, plane[rows-1][j].z);
				vertex(plane[0][j].x, plane[0][j].y, plane[0][j].z);
				vertex(plane[0][j+1].x, plane[0][j+1].y, plane[0][j+1].z);

				vertex(plane[rows-1][j].x, plane[rows-1][j].y, plane[rows-1][j].z);
				vertex(plane[rows-1][j+1].x, plane[rows-1][j+1].y, plane[rows-1][j+1].z);
				vertex(plane[0][j+1].x, plane[0][j+1].y, plane[0][j+1].z);
				endShape();
			}
		}

		function fillLastSeam() {
			beginShape();
			fill(0,0,0/rows*100+155);
			
			vertex(plane[rows-1][cols-1].x, plane[rows-1][cols-1].y, plane[rows-1][cols-1].z);
			vertex(plane[0][cols-1].x, plane[0][cols-1].y, plane[0][cols-1].z);
			vertex(plane[0][0].x, plane[0][0].y, plane[0][0].z);

			vertex(plane[rows-1][cols-1].x, plane[rows-1][cols-1].y, plane[rows-1][cols-1].z);
			vertex(plane[rows-1][0].x, plane[rows-1][0].y, plane[rows-1][0].z);
			vertex(plane[0][0].x, plane[0][0].y, plane[0][0].z);
			
			endShape();
		}

	</script>
</body>

</html>